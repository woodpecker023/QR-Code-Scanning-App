<!DOCTYPE html>
<html>
<head>
    <title>Camera Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        video {
            width: 100%;
            max-width: 500px;
            border: 2px solid #333;
            border-radius: 8px;
            background: #000;
        }
        button {
            padding: 15px 30px;
            font-size: 16px;
            margin: 10px 5px;
            cursor: pointer;
            border-radius: 5px;
            border: none;
            background: #1976d2;
            color: white;
        }
        button:hover {
            background: #1565c0;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <h1>Camera Test for iPhone</h1>
    <p>This page tests if your camera works in the browser.</p>

    <div id="status"></div>
    <div id="info" class="info"></div>

    <video id="video" autoplay playsinline></video>

    <div>
        <button onclick="startCamera()">Start Camera</button>
        <button onclick="stopCamera()">Stop Camera</button>
    </div>

    <script>
        const video = document.getElementById('video');
        const status = document.getElementById('status');
        const info = document.getElementById('info');
        let stream = null;

        // Show device info
        info.innerHTML = `
            <strong>Device Info:</strong><br>
            User Agent: ${navigator.userAgent}<br>
            Platform: ${navigator.platform}<br>
            HTTPS: ${window.location.protocol === 'https:'}<br>
            MediaDevices: ${!!navigator.mediaDevices}<br>
            getUserMedia: ${!!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)}
        `;

        async function startCamera() {
            status.innerHTML = '<div class="info">Starting camera...</div>';

            try {
                // Request camera with back camera preference
                const constraints = {
                    video: {
                        facingMode: 'environment',
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    },
                    audio: false
                };

                console.log('Requesting camera with constraints:', constraints);

                stream = await navigator.mediaDevices.getUserMedia(constraints);

                console.log('Camera stream obtained:', stream);
                console.log('Video tracks:', stream.getVideoTracks());

                video.srcObject = stream;

                status.innerHTML = '<div class="success">âœ“ Camera started successfully!</div>';

                // Show stream details
                const tracks = stream.getVideoTracks();
                if (tracks.length > 0) {
                    const settings = tracks[0].getSettings();
                    status.innerHTML += `<div class="info">
                        Resolution: ${settings.width}x${settings.height}<br>
                        Facing Mode: ${settings.facingMode || 'unknown'}<br>
                        Device: ${tracks[0].label}
                    </div>`;
                }
            } catch (err) {
                console.error('Camera error:', err);
                status.innerHTML = `<div class="error">
                    <strong>Error:</strong> ${err.name}<br>
                    <strong>Message:</strong> ${err.message}<br><br>
                    ${getErrorHelp(err.name)}
                </div>`;
            }
        }

        function stopCamera() {
            if (stream) {
                stream.getTracks().forEach(track => {
                    track.stop();
                    console.log('Stopped track:', track);
                });
                video.srcObject = null;
                stream = null;
                status.innerHTML = '<div class="info">Camera stopped.</div>';
            }
        }

        function getErrorHelp(errorName) {
            switch (errorName) {
                case 'NotAllowedError':
                    return 'Camera permission denied. Go to Settings > Safari > Camera and allow access.';
                case 'NotFoundError':
                    return 'No camera found on this device.';
                case 'NotReadableError':
                    return 'Camera is being used by another app. Close other apps and try again.';
                case 'OverconstrainedError':
                    return 'Camera does not support the requested settings.';
                default:
                    return 'Unknown error. Try reloading the page.';
            }
        }

        // Stop camera when page is closed
        window.addEventListener('beforeunload', stopCamera);
    </script>
</body>
</html>
